import React, { createContext, useCallback, useContext, useMemo, useState } from "react";

type Lang = "ru" | "en";

type Dict = Record<string, string>;

type I18nValue = {
  lang: Lang;
  setLang: (lang: Lang) => void;
  t: (key: string) => string;
};

const messages: Record<Lang, Dict> = {
  ru: {
    "toolbar.undo": "Отменить",
    "toolbar.redo": "Повторить",
    "toolbar.addSlide": "Добавить слайд",
    "toolbar.player": "Плеер",
    "toolbar.addText": "Добавить текст",
    "toolbar.addImage": "Добавить изображение",
    "toolbar.export": "Экспорт",
    "toolbar.export.pdf": "PDF",
    "toolbar.export.json": "JSON",
    "toolbar.import.json": "Импорт JSON",
    "toolbar.align": "Выравнивание",
    "toolbar.delete": "Удалить",
    "toolbar.setBackground": "Фон",
    "toolbar.clearBackground": "Сбросить фон",
    "toolbar.backgroundImage": "Фон: изображение",
    "toolbar.align.left": "Слева",
    "toolbar.align.center": "По центру",
    "toolbar.align.right": "Справа",
    "toolbar.align.top": "Сверху",
    "toolbar.align.middle": "По центру",
    "toolbar.align.bottom": "Снизу",
    "slideTemplate.add": "Добавить шаблон",
    "template.title": "Титульный",
    "template.title-object": "Заголовок и объект",
    "template.section-header": "Заголовок раздела",
    "template.two-objects": "Два объекта",
    "template.comparison": "Сравнение",
    "template.title-only": "Только заголовок",
    "template.blank": "Пустой",
    "template.object-caption": "Объект с подписью",
    "template.picture-caption": "Рисунок с подписью",
    "slideList.title": "Слайды",
    "slideList.slide": "Слайд",
    "slideList.id": "ID",
    "workspace.title": "Рабочая область",
    "player.back": "Назад к редактору",
    "player.prev": "Назад",
    "player.next": "Далее",
    "textMenu.background": "Фон текста",
    "textMenu.color": "Цвет текста",
    "textMenu.borderColor": "Цвет рамки",
    "textMenu.borderWidth": "Толщина рамки",
    "textMenu.size": "Размер шрифта",
    "textMenu.font": "Шрифт",
    "textMenu.align": "Выравнивание текста",
    "textMenu.left": "Слева",
    "textMenu.center": "По центру",
    "textMenu.right": "Справа",
    "textMenu.format": "Формат",
    "textMenu.bold": "Жирный",
    "textMenu.italic": "Курсив",
    "textMenu.underline": "Подчеркнутый",
    "textMenu.clear": "Убрать фон",
    "imageMenu.replace": "Заменить изображение",
    "editor.signedInAs": "Вход выполнен как",
    "editor.dashboard": "Панель",
    "editor.saving": "Сохранение...",
    "editor.saved": "Сохранено",
    "editor.notConfigured": "Appwrite БД/хранилище не настроены.",
    "editor.signOut": "Выйти",
    "dashboard.title": "Ваши презентации",
    "dashboard.signedInAs": "Вход выполнен как:",
    "dashboard.signOut": "Выйти",
    "dashboard.newPresentation": "Новая презентация",
    "dashboard.notConfigured": "Appwrite БД/хранилище не настроены.",
    "dashboard.loading": "Загрузка...",
    "dashboard.empty.title": "Презентаций пока нет",
    "dashboard.empty.note": "Создайте новую презентацию, чтобы начать.",
    "dashboard.empty.create": "Создать презентацию",
    "dashboard.untitled": "Без названия",
    "dashboard.updated": "Обновлено:",
    "dashboard.open": "Открыть",
    "dashboard.rename": "Переименовать",
    "dashboard.delete": "Удалить",
    "dashboard.modal.createTitle": "Создать презентацию",
    "dashboard.modal.renameTitle": "Переименовать презентацию",
    "dashboard.modal.titleLabel": "Название",
    "dashboard.modal.cancel": "Отмена",
    "dashboard.modal.create": "Создать",
    "dashboard.modal.save": "Сохранить",
    "auth.notConfigured.title": "Appwrite не настроен",
    "auth.notConfigured.note": "Укажите VITE_APPWRITE_ENDPOINT и VITE_APPWRITE_PROJECT_ID в переменных окружения.",
    "auth.loadingSession": "Загрузка сессии...",
    "auth.signIn": "Вход",
    "auth.createAccount": "Создать аккаунт",
    "auth.name": "Имя",
    "auth.email": "Email",
    "auth.password": "Пароль",
    "auth.showPassword": "Показать пароль",
    "auth.hidePassword": "Скрыть пароль",
    "auth.pleaseWait": "Подождите...",
    "auth.register": "Зарегистрироваться",
    "auth.needAccount": "Нужен аккаунт? Регистрация",
    "auth.haveAccount": "Уже есть аккаунт? Войти",
    "routes.loadingPresentation": "Загрузка презентации...",
    "upload.signIn": "Войдите, чтобы загрузить изображения.",
    "upload.notConfigured": "Хранилище Appwrite не настроено.",
    "upload.failed": "Не удалось загрузить изображение.",
    "lang.toggle": "RU/EN",
  },
  en: {
    "toolbar.undo": "Undo",
    "toolbar.redo": "Redo",
    "toolbar.addSlide": "Add slide",
    "toolbar.player": "Player",
    "toolbar.addText": "Add text",
    "toolbar.addImage": "Add image",
    "toolbar.export": "Export",
    "toolbar.export.pdf": "PDF",
    "toolbar.export.json": "JSON",
    "toolbar.import.json": "Import JSON",
    "toolbar.align": "Align",
    "toolbar.delete": "Delete",
    "toolbar.setBackground": "Set background",
    "toolbar.clearBackground": "Clear background",
    "toolbar.backgroundImage": "Background image",
    "toolbar.align.left": "Left",
    "toolbar.align.center": "Center",
    "toolbar.align.right": "Right",
    "toolbar.align.top": "Top",
    "toolbar.align.middle": "Middle",
    "toolbar.align.bottom": "Bottom",
    "slideTemplate.add": "Add template",
    "template.title": "Title",
    "template.title-object": "Title + Object",
    "template.section-header": "Section Header",
    "template.two-objects": "Two Objects",
    "template.comparison": "Comparison",
    "template.title-only": "Title Only",
    "template.blank": "Blank",
    "template.object-caption": "Object + Caption",
    "template.picture-caption": "Picture + Caption",
    "slideList.title": "Slides",
    "slideList.slide": "Slide",
    "slideList.id": "id",
    "workspace.title": "Workspace",
    "player.back": "Back to editor",
    "player.prev": "Prev",
    "player.next": "Next",
    "textMenu.background": "Text background",
    "textMenu.color": "Text color",
    "textMenu.borderColor": "Border color",
    "textMenu.borderWidth": "Border width",
    "textMenu.size": "Font size",
    "textMenu.font": "Font family",
    "textMenu.align": "Text align",
    "textMenu.left": "Left",
    "textMenu.center": "Center",
    "textMenu.right": "Right",
    "textMenu.format": "Format",
    "textMenu.bold": "Bold",
    "textMenu.italic": "Italic",
    "textMenu.underline": "Underline",
    "textMenu.clear": "Clear background",
    "imageMenu.replace": "Replace image",
    "editor.signedInAs": "Signed in as",
    "editor.dashboard": "Dashboard",
    "editor.saving": "Saving...",
    "editor.saved": "Saved",
    "editor.notConfigured": "Appwrite DB/Storage is not configured.",
    "editor.signOut": "Sign out",
    "dashboard.title": "Your presentations",
    "dashboard.signedInAs": "Signed in as:",
    "dashboard.signOut": "Sign out",
    "dashboard.newPresentation": "New presentation",
    "dashboard.notConfigured": "Appwrite DB/Storage is not configured.",
    "dashboard.loading": "Loading...",
    "dashboard.empty.title": "No presentations yet",
    "dashboard.empty.note": "Create a new presentation to get started.",
    "dashboard.empty.create": "Create presentation",
    "dashboard.untitled": "Untitled",
    "dashboard.updated": "Updated:",
    "dashboard.open": "Open",
    "dashboard.rename": "Rename",
    "dashboard.delete": "Delete",
    "dashboard.modal.createTitle": "Create presentation",
    "dashboard.modal.renameTitle": "Rename presentation",
    "dashboard.modal.titleLabel": "Title",
    "dashboard.modal.cancel": "Cancel",
    "dashboard.modal.create": "Create",
    "dashboard.modal.save": "Save",
    "auth.notConfigured.title": "Appwrite is not configured",
    "auth.notConfigured.note": "Set VITE_APPWRITE_ENDPOINT and VITE_APPWRITE_PROJECT_ID in your env.",
    "auth.loadingSession": "Loading session...",
    "auth.signIn": "Sign in",
    "auth.createAccount": "Create account",
    "auth.name": "Name",
    "auth.email": "Email",
    "auth.password": "Password",
    "auth.showPassword": "Show password",
    "auth.hidePassword": "Hide password",
    "auth.pleaseWait": "Please wait...",
    "auth.register": "Register",
    "auth.needAccount": "Need an account? Register",
    "auth.haveAccount": "Already have an account? Sign in",
    "routes.loadingPresentation": "Loading presentation...",
    "upload.signIn": "Sign in to upload images.",
    "upload.notConfigured": "Appwrite storage is not configured.",
    "upload.failed": "Failed to upload image.",
    "lang.toggle": "RU/EN",
  },
};

const I18nContext = createContext<I18nValue>({
  lang: "ru",
  setLang: () => { },
  t: (key: string) => key,
});

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [lang, setLang] = useState<Lang>("ru");
  const t = useCallback((key: string) => messages[lang][key] ?? key, [lang]);
  const value = useMemo(() => ({ lang, setLang, t }), [lang, t]);
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  return useContext(I18nContext);
}
